var Te=Module("Tellurium")({children:[],completedChildren:[],isCompleted:false,reporter:null,suite:function(b){var a=function(d){var c=new Tellurium.Suite(b,d);c.setParent(Tellurium);Tellurium.children.push(c);return c};return a},run:function(c){var b,a,d;this.completedChildren=[];this.isCompleted=false;if(typeof c==="string"){c=[c]}if(c){for(a=0;a<c.length;a+=1){d=c[a];for(b=0;b<this.children.length;b+=1){if(this.children[b].description===d){console.time("run "+this.children[b].description);this.children[b].run()}}}}else{console.time("run all");for(b=0;b<this.children.length;b+=1){Tellurium.children[b].run()}}return this},childCompleted:function(a){this.completedChildren.push(a);if(this.reporter===null){this.reporter=new Tellurium.Reporter.Firebug()}console.timeEnd("run "+a.description);this.reporter.run(a);if(this.children.length===this.completedChildren.length){this.completed()}return this},completed:function(){this.isCompleted=true;console.timeEnd("run all");return this}});Class(Tellurium,"Stub")({prototype:{targetObject:null,methodName:null,newMethod:null,originalMethod:null,init:function(a){a=a||{};this.targetObject=a.targetObject;this.methodName=a.methodName;this.newMethod=a.newMethod},applyStub:function(){this.originalMethod=this.targetObject[this.methodName];this.targetObject[this.methodName]=this.newMethod;return this},removeStub:function(){this.targetObject[this.methodName]=this.originalMethod;return this},on:function(a){this.targetObject=a;return this},method:function(a){this.methodName=a;return this},using:function(a){this.newMethod=a;this.applyStub();return this}}});Module(Tellurium.Stub,"Factory")({prototype:{stubs:null,stub:function(){var a=new Tellurium.Stub();this.stubs=this.stubs||[];this.stubs.push(a);return a},cleanStubs:function(){var a;for(a=0;a<this.stubs.length;a+=1){this.stubs[a].removeStub()}return this}}});Class(Tellurium,"Spy")({prototype:{targetObject:null,methodName:null,spyMethod:null,originalMethod:null,called:null,init:function(a){a=a||{};this.called=[];this.targetObject=a.targetObject;this.methodName=a.methodName},applySpy:function(){var a;a=this;this.originalMethod=this.targetObject[this.methodName];this.targetObject[this.methodName]=function(){var c,b;c=Array.prototype.slice.call(arguments,0,arguments.length);b=a.originalMethod.apply(a.targetObject,c);a.called.push({arguments:c,returned:b});return b};return this},removeSpy:function(){this.targetObject[this.methodName]=this.originalMethod;return this},on:function(a){this.targetObject=a;return this},method:function(a){this.methodName=a;this.applySpy();return this}}});Module(Tellurium.Spy,"Factory")({prototype:{spies:null,spy:function(){var a=new Tellurium.Spy();this.spies=this.spies||[];this.spies.push(a);return a},cleanSpies:function(){var a;for(a=0;a<this.spies.length;a+=1){this.spies[a].removeSpy()}return this}}});Class(Tellurium,"Assertion")({includeAssertions:function(b){var a;for(a in b){if(b.hasOwnProperty(a)){this.prototype.addAssert(a,b[a])}}return this},prototype:{TYPE_TRUE:"TYPE_TRUE",TYPE_FALSE:"TYPE_FALSE",STATUS_FAIL:"STATUS_FAIL",STATUS_SUCCESS:"STATUS_SUCCESS",actual:null,expected:null,spec:null,status:null,type:null,init:function(b,a){this.type=this.TYPE_TRUE;this.actual=b;this.spec=a},not:function(){this.type=this.TYPE_FALSE;return this},notify:function(a){if(a===true){if(this.type===this.TYPE_FALSE){this.status=this.STATUS_FAIL;this.spec.assertionFailed(this)}else{this.status=this.STATUS_SUCCESS;this.spec.assertionPassed(this)}}else{if(this.type===this.TYPE_FALSE){this.status=this.STATUS_SUCCESS;this.spec.assertionPassed(this)}else{this.status=this.STATUS_FAIL;this.spec.assertionFailed(this)}}return this},addAssert:function(a,b){this[a]=function(){var c;c=Array.prototype.slice.call(arguments,0,arguments.length);this.invoqued=a;this.expected=c;this.notify(b.apply(this,c));return null};return this}}});Tellurium.Assertion.includeAssertions({toBe:function(a){return(this.actual===a)},toEqual:function(a){return(this.actual==a)},toMatch:function(a){return(a.test(this.actual)===true)},toBeDefined:function(){return(typeof this.actual!=="undefined")},toBeNull:function(){return(this.actual===null)},toBeTruthy:function(){return((this.actual)?true:false)},toBeCalled:function(){return(this.actual.called.length>0)},toBeCalledWith:function(a){return(this.actual.called[0].arguments===a)},toReturn:function(a){return(this.actual.called[0].returned===a)},toBeGreaterThan:function(a){return(this.actual>a)},toBeLessThan:function(a){return(this.actual<a)},toBeInstanceOf:function(a){return(this.actual.constructor===a)},toThrowError:function(a){try{this.actual()}catch(b){if(b===a||b.name===a){return true}}return false},toNotThrowError:function(){try{this.actual();return true}catch(a){return false}}});Module(Tellurium,"Context")({prototype:{registry:null,description:null,code:null,parent:null,children:null,completedChildren:null,setupCode:null,tearDownCode:null,beforeEachPool:null,completedBeforeEach:null,afterEachPool:null,completedAfterEach:null,isCompleted:null,init:function(b,a){this.registry=[];this.description=b;this.code=a;this.children=[];this.completedChildren=[];this.beforeEachPool=[];this.completedBeforeEach=[];this.completedAfterEach=[];this.afterEachPool=[];this.isCompleted=false},appendChild:function(a){if(a.parent){a.parent.removeChild(a)}this.children.push(a);a.setParent(this);return a},setParent:function(a){this.parent=a;return this},setup:function(a){this.setupCode=new Tellurium.Executable(a);return this},tearDown:function(a){this.tearDownCode=new Tellurium.Executable(a);return this},describe:function(b){var c,a,d;c=this;a=function(g){var f=new Tellurium.Description(b,g);if(d===true){f.guided=true;var e=0;f.run=function(){this.code.call(this,this);if(this.children.length===0){this.completed()}if(this.setupCode){this.setupCode.run()}if(this.children[e] instanceof Tellurium.Specification){this.runBeforeEach(this,this.children[e])}this.children[e].run();return this};f.childCompleted=function(h){this.completedChildren.push(h);if(h instanceof Tellurium.Specification){this.runAfterEach(h)}if(this.children.length===this.completedChildren.length){this.completed()}else{e=e+1;if(this.children[e] instanceof Tellurium.Specification){this.runBeforeEach(this,this.children[e])}this.children[e].run()}return this}}else{f.guided=false}c.appendChild(f);return c};a.guided=function(){d=true;return a};return a},specify:function(c){var d=this;var b=false;var a=function(f){var e=new Tellurium.Specification(c,f);e.sync=b;d.appendChild(e)};a.sync=function(){b=true;return a};return a},beforeEach:function(a){this.beforeEachPool.push(a);return this},afterEach:function(a){this.afterEachPool.push(a);return this},run:function(){var b,a;a=this;this.children=[];this.completedChildren=[];this.code.call(this,this);if(this.children.length===0){this.completed()}if(this.setupCode){this.setupCode.onCompleted(function(){for(b=0;b<a.children.length;b+=1){if(a.children[b] instanceof Tellurium.Specification){a.runBeforeEach(a,a.children[b])}a.children[b].run()}});this.setupCode.run()}else{for(b=0;b<this.children.length;b+=1){if(this.children[b] instanceof Tellurium.Specification){this.runBeforeEach(this,this.children[b])}this.children[b].run()}}return this},runBeforeEach:function(c,b){var a;b=b||this;if(this.parent&&this.parent.runBeforeEach){this.parent.runBeforeEach(c,b)}for(a=0;a<this.beforeEachPool.length;a+=1){this.beforeEachPool[a].call(b,c,b)}return this},runAfterEach:function(b){var a;b=b||this;if(this.parent&&this.parent.runAfterEach){this.parent.runAfterEach(b)}for(a=0;a<this.afterEachPool.length;a+=1){this.afterEachPool[a].call(b,b)}return this},childCompleted:function(a){this.completedChildren.push(a);if(a instanceof Tellurium.Specification){this.runAfterEach(a)}if(this.children.length===this.completedChildren.length){this.completed()}return this},completed:function(){var a;a=this;this.isCompleted=true;if(this.spies){this.cleanSpies()}if(this.stubs){this.cleanStubs()}if(this.tearDownCode){this.tearDownCode.onCompleted(function(){if(a.parent){a.parent.childCompleted(a)}});this.tearDownCode.run()}else{if(this.parent){this.parent.childCompleted(this)}}return this}}});Class(Tellurium,"Executable")({prototype:{code:null,isCompleted:null,isAsynchronous:true,init:function(a){this.code=a},completed:function(){this.isCompleted=true;this.onCompletedCode();return this},run:function(){this.isCompleted=false;this.code.apply(this);return this},onCompleted:function(a){this.onCompletedCode=function(){a();return this};return this}}});Class(Tellurium,"Suite").includes(Tellurium.Context,Tellurium.Stub.Factory,Tellurium.Spy.Factory)({});Class(Tellurium,"Description").includes(Tellurium.Context,Tellurium.Stub.Factory,Tellurium.Spy.Factory)({prototype:{guided:false}});Class(Tellurium,"Specification").includes(Tellurium.Stub.Factory,Tellurium.Spy.Factory)({prototype:{STATUS_PENDING:"STATUS_PENDING",STATUS_FAIL:"STATUS_FAIL",STATUS_SUCCESS:"STATUS_SUCCESS",description:null,code:null,parent:null,assertions:null,registry:null,status:null,isCompleted:null,sync:false,init:function(b,a){this.description=b;this.code=a;this.registry={};this.assertions=[];this.spies=[];this.stubs=[];this.isCompleted=false},setParent:function(a){this.parent=a;return this},run:function(){if(this.code){this.code.call(this,this);if(this.sync===true){this.completed()}}else{this.pending()}},pending:function(){this.status=this.STATUS_PENDING;this.completed()},assertionPassed:function(){if(this.status!==this.STATUS_FAIL){this.status=this.STATUS_SUCCESS}return this},assertionFailed:function(){this.status=this.STATUS_FAIL;return this},assert:function(b){var a=new Tellurium.Assertion(b,this);this.assertions.push(a);return a},mock:function(){return{}},completed:function(){this.isCompleted=true;if(this.spies){this.cleanSpies()}if(this.stubs){this.cleanStubs()}if(this.status===null){this.status=this.STATUS_SUCCESS}this.parent.childCompleted(this);return this}}});Tellurium.Reporter={};Class(Tellurium.Reporter,"Firebug")({prototype:{totalSpecs:null,failedSpecs:null,passedSpecs:null,pendingSpecs:null,init:function(){this.totalSpecs=0;this.failedSpecs=0;this.passedSpecs=0;this.pendingSpecs=0},run:function(a){console.log("Tellurium Test Results for "+a.description);this.totalSpecs=0;this.passedSpecs=0;this.failedSpecs=0;this.pendingSpecs=0;this.suite(a);console.info("Total: ",this.totalSpecs);console.info("Passed: ",this.passedSpecs);console.info("%cFailed: "+this.failedSpecs,"background-color:#FFEBEB; color : #FF2424");console.warn("Pending: ",this.pendingSpecs);console.log("End")},suite:function(b){var a;console.group(b.description);for(a=0;a<b.children.length;a+=1){if(b.children[a] instanceof Tellurium.Description){this.description(b.children[a])}else{if(b.children[a] instanceof Tellurium.Specification){this.specification(b.children[a])}}}console.groupEnd(b.description)},description:function(b){var a;console.group(b.description);for(a=0;a<b.children.length;a+=1){if(b.children[a] instanceof Tellurium.Description){this.description(b.children[a])}else{if(b.children[a] instanceof Tellurium.Specification){this.specification(b.children[a])}}}console.groupEnd(b.description)},specification:function(b){var a;this.totalSpecs=this.totalSpecs+1;if(b.status===b.STATUS_FAIL){this.failedSpecs=this.failedSpecs+1;console.error(b.description,"")}else{if(b.status===b.STATUS_SUCCESS){this.passedSpecs=this.passedSpecs+1;console.info(b.description,"")}else{if(b.status===b.STATUS_PENDING){this.pendingSpecs=this.pendingSpecs+1;console.warn(b.description,"")}}}console.groupCollapsed("assertions");for(a=0;a<b.assertions.length;a+=1){this.assertion(b.assertions[a])}console.groupEnd("assertions")},assertion:function(a){var b;if(a.type===Tellurium.Assertion.prototype.TYPE_FALSE){b=" not "}else{b=" "}if(a.status===a.STATUS_SUCCESS){console.info(a.actual,b,a.invoqued," ",a.expected||"")}else{if(a.status===a.STATUS_FAIL){console.error(a.actual,b,a.invoqued," ",a.expected||"")}}}}});